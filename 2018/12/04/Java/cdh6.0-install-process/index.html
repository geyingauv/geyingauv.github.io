<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="virle's blog, virle, geying, geyingauv"><title>CDH 6.0.0 安装记录 - Virle's blog</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c3d02a6e0e241c65a29e535825d0d1db";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com/geyingauv"><span>Github</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="/post-bg.jpg"><div class="post-title"><h1 class="title">CDH 6.0.0 安装记录</h1><ul class="meta"><li><i class="icon icon-author"></i>Virle</li><li><i class="icon icon-clock"></i>34 Minutes</li><li><i class="icon icon-calendar"></i>December 4, 2018</li></ul></div></div><div class="article-content" style="max-width:800px"><p>最近又来了几个服务器，整了一套虚拟环境，需要在上面部署一套 cdh hadoop 环境。不想再去看 csdn 上文档搬运工写的帖子了，直接看官方文档排排坑。<br><a id="more"></a></p>
<p>##Befor install</p>
<ol>
<li>设置SELINUX模式<br>执行 <code>getenforce</code><br>如果输出 <code>Permissive</code> 或 <code>Disabled</code> 进行下一步（关闭防火墙）。<br>如果为 <code>enforcing</code> 执行以下操作:<br><code>sudo vim /etc/selinux/config</code><br>修改为 <code>SELINUX=permissive</code><br><img src="./cdh6.0-install-process/selinux.png" alt=""></li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 使设置生效</span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure>
<p>等安装部署完后可以再改回去<br>执行 <code>setenforce 1</code></p>
<ol start="2">
<li><p>关闭防火墙</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status firewalld.service</span><br><span class="line"><span class="meta">#</span> 关闭防火墙</span><br><span class="line">sudo systemctl stop firewalld.service</span><br><span class="line"><span class="meta">#</span> 禁用</span><br><span class="line">sudo systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>
</li>
<li><p>开启NTP</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install ntp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>配置时间同步服务器，默认有</span><br><span class="line">sudo vim /etc/ntp.conf</span><br><span class="line"></span><br><span class="line">sudo systemctl start ntpd</span><br><span class="line">sudo systemctl enable ntpd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>同步时间</span><br><span class="line">sudo hwclock --systohc</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置主机名</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hostname</span><br><span class="line">centosxxx</span><br><span class="line"></span><br><span class="line">sudo vim /etc/hosts</span><br><span class="line"></span><br><span class="line">172.17.13.xxx centosxxx    </span><br><span class="line">172.17.13.xxx centosxxx</span><br><span class="line">172.17.13.xxx centosxxx</span><br><span class="line">172.17.13.xxx centosxxx</span><br></pre></td></tr></table></figure>
<p>集群中每台机器都重复此操作</p>
<h2 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h2><ol>
<li>创建用户</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adduser cdh</span><br><span class="line">pwsswd cdh</span><br></pre></td></tr></table></figure>
<p>添加sudo权限<br><code>vim /etc/sodoers</code><br>添加 <code>cdh     ALL=(ALL)       NOPASSWD:ALL</code></p>
<p><img src="./cdh6.0-install-process/sudoers.png" alt=""><br>集群中每台机器都重复此操作</p>
<ol start="2">
<li>设置dns<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/NetworkManager/NetworkManager.conf</span><br><span class="line"></span><br><span class="line">dns=none</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="./cdh6.0-install-process/networkmanager.png" alt=""><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br><span class="line"></span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure></p>
<p><img src="./cdh6.0-install-process/resolv.png" alt=""></p>
<ol start="3">
<li><p>设置仓库地址</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su cdh</span><br><span class="line">sudo rpm --import https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPM-GPG-KEY-cloudera</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置JAVA_HOME</p>
<blockquote>
<p>Requirements<br>The JDK must be 64-bit. Do not use a 32-bit JDK.<br>jdk 必须为64位<br>The installed JDK must be a supported version as documented in <a href="https://www.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_java_requirements.html#java_requirements" target="_blank" rel="noopener">Java Requirements</a>.<br>必须是<a href="https://www.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_java_requirements.html#java_requirements" target="_blank" rel="noopener">Java Requirements</a>文档中支持的版本<br>The same version of the Oracle JDK must be installed on each cluster host.<br>集群中的每台机器的oracle jdk版本都必须相同<br>The JDK must be installed at /usr/java/jdk-version.<br>jdk必须安装在<code>/usr/java/jdk-version</code>目录</p>
</blockquote>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">JAVA_HOME=/usr/java/jdk1.8</span><br></pre></td></tr></table></figure>
<p>集群中每台机器都重复此操作</p>
<ol start="5">
<li><p>下载rpm包<br>从 <a href="https://www.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_cm_6_version_download.html#cm_600_version_download" target="_blank" rel="noopener">Cloudera Manager 6.0.0 仓库地址</a> 选择要安装的版本 这里选6.0<br>选择 <a href="https://archive.cloudera.com/cm6/6.0.0/redhat7/yum/RPMS/x86_64/" target="_blank" rel="noopener">redhat7仓库地址</a> 下载地址</p>
</li>
<li><p>安装cloudera-manager-server</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 这里需要先配置 `JAVA_HOME` 否则会报错</span><br><span class="line">rpm -i cloudera-manager-daemons-6.0.0-530873.el7.x86_64.rpm</span><br><span class="line"><span class="meta">#</span> 这里需要使用yum来解决依赖问题</span><br><span class="line">yum -install cloudera-manager-agent-6.0.0-530873.el7.x86_64.rpm</span><br><span class="line"><span class="meta">#</span> 同上</span><br><span class="line">yum -install cloudera-manager-server-6.0.0-530873.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装数据库<br>这里 <a href="https://dev.mysql.com/downloads/file/?id=480402" target="_blank" rel="noopener">下载</a> mysql5.6 rpm包</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 查看是否安装了 mariadb 数据库</span><br><span class="line">rpm -qa | grep mariadb</span><br><span class="line"><span class="meta">#</span> 如果有 卸载先</span><br><span class="line">sudo rpm -e mariadb-libs-5.5.44-2.el7.centos.x86_64 --nodeps</span><br><span class="line"><span class="meta">#</span> 安装 mysql</span><br><span class="line">sudo yum install MySQL-server-5.6.42-1.el7.x86_64.rpm </span><br><span class="line"><span class="meta">#</span> 安装 mysql-shared-compat Cloudera文档标示必须安装</span><br><span class="line">sudo yum install MySQL-shared-compat-5.6.42-1.el7.x86_64.rpm</span><br><span class="line"><span class="meta">#</span> 安装 mysql 客户端</span><br><span class="line">sudo yum install MySQL-client-5.6.42-1.el7.x86_64.rpm </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 安装成功后查看初始化密码</span><br><span class="line">sudo cat /root/.mysql_secret</span><br><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line">SET PASSWORD = PASSWORD('123456');</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">sudo cp /usr/share/mysql/my-default.cnf my.cnf</span><br><span class="line">sudo vim /usr/share/mysql/my.cnf</span><br></pre></td></tr></table></figure>
<p>my.cnf<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">datadir</span>=/var/lib/mysql</span><br><span class="line"><span class="attr">socket</span>=/var/lib/mysql/mysql.sock</span><br><span class="line"><span class="attr">transaction-isolation</span> = READ-COMMITTED</span><br><span class="line"><span class="comment"># Disabling symbolic-links is recommended to prevent assorted security risks;</span></span><br><span class="line"><span class="comment"># to do so, uncomment this line:</span></span><br><span class="line"><span class="attr">symbolic-links</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">key_buffer_size</span> = <span class="number">32</span>M</span><br><span class="line"><span class="attr">max_allowed_packet</span> = <span class="number">32</span>M</span><br><span class="line"><span class="attr">thread_stack</span> = <span class="number">256</span>K</span><br><span class="line"><span class="attr">thread_cache_size</span> = <span class="number">64</span></span><br><span class="line"><span class="attr">query_cache_limit</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">query_cache_size</span> = <span class="number">64</span>M</span><br><span class="line"><span class="attr">query_cache_type</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_connections</span> = <span class="number">550</span></span><br><span class="line"><span class="comment">#expire_logs_days = 10</span></span><br><span class="line"><span class="comment">#max_binlog_size = 100M</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#log_bin should be on a disk with enough free space.</span></span><br><span class="line"><span class="comment">#Replace '/var/lib/mysql/mysql_binary_log' with an appropriate path for your</span></span><br><span class="line"><span class="comment">#system and chown the specified folder to the mysql user.</span></span><br><span class="line"><span class="attr">log_bin</span>=/var/lib/mysql/mysql_binary_log</span><br><span class="line"></span><br><span class="line"><span class="comment">#In later versions of MySQL, if you enable the binary log and do not set</span></span><br><span class="line"><span class="comment">#a server_id, MySQL will not start. The server_id must be unique within</span></span><br><span class="line"><span class="comment">#the replicating group.</span></span><br><span class="line"><span class="attr">server_id</span>=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">binlog_format</span> = mixed</span><br><span class="line"></span><br><span class="line"><span class="attr">read_buffer_size</span> = <span class="number">2</span>M</span><br><span class="line"><span class="attr">read_rnd_buffer_size</span> = <span class="number">16</span>M</span><br><span class="line"><span class="attr">sort_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"><span class="attr">join_buffer_size</span> = <span class="number">8</span>M</span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDB settings</span></span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span>  = <span class="number">2</span></span><br><span class="line"><span class="attr">innodb_log_buffer_size</span> = <span class="number">64</span>M</span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="number">4</span>G</span><br><span class="line"><span class="attr">innodb_thread_concurrency</span> = <span class="number">8</span></span><br><span class="line"><span class="attr">innodb_flush_method</span> = O_DIRECT</span><br><span class="line"><span class="attr">innodb_log_file_size</span> = <span class="number">512</span>M</span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld_safe]</span></span><br><span class="line"><span class="attr">log-error</span>=/var/log/mysqld.log</span><br><span class="line"><span class="attr">pid-file</span>=/var/run/mysqld/mysqld.pid</span><br><span class="line"></span><br><span class="line"><span class="attr">sql_mode</span>=STRICT_ALL_TABLES</span><br></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysql</span><br></pre></td></tr></table></figure>
<ol start="8">
<li><p>下载jdbc驱动<br>点击<a href="https://dev.mysql.com/downloads/connector/j/5.1.html" target="_blank" rel="noopener">下载</a><br>官方文档推荐版本5.1</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -vxf mysql-connector-java-5.1.47.tar.gz</span><br><span class="line">sudo mkdir -p /usr/share/java/</span><br><span class="line"></span><br><span class="line">sudo cp mysql-connector-java-5.1.47/mysql-connector-java-5.1.47.jar /usr/share/java/mysql-connector-java.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>为 Cloudera Software 创建数据库<br>Cloudera Manager Server    scm    scm<br>Activity Monitor    amon    amon<br>Reports Manager    rman    rman<br>Hue    hue    hue<br>Hive Metastore Server    metastore    hive<br>Sentry Server    sentry    sentry<br>Cloudera Navigator Audit Server    nav    nav<br>Cloudera Navigator Metadata Server    navms    navms<br>Oozie    oozie    oozie</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> scm <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> amon <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> rman <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> hue <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> metastore <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> sentry <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">nav</span> <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> navms <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> oozie <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">DEFAULT</span> <span class="keyword">COLLATE</span> utf8_general_ci;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> scm.* <span class="keyword">TO</span> <span class="string">'scm'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'scm'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> amon.* <span class="keyword">TO</span> <span class="string">'amon'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'amon'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> rman.* <span class="keyword">TO</span> <span class="string">'rman'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'rman'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> hue.* <span class="keyword">TO</span> <span class="string">'hue'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'hue'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> metastore.* <span class="keyword">TO</span> <span class="string">'hive'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'hive'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> sentry.* <span class="keyword">TO</span> <span class="string">'sentry'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'sentry'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> nav.* <span class="keyword">TO</span> <span class="string">'nav'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'nav'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> navms.* <span class="keyword">TO</span> <span class="string">'navms'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'navms'</span>;</span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> oozie.* <span class="keyword">TO</span> <span class="string">'oozie'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'oozie'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 确认是否创建成功</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> <span class="string">'&lt;user&gt;'</span>@<span class="string">'%'</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm</span><br></pre></td></tr></table></figure>
<p><img src="./cdh6.0-install-process/scm-server.png" alt=""></p>
<ol start="10">
<li>安装 cdh 和其他软件<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start cloudera-scm-server</span><br><span class="line"><span class="meta">#</span> 查看日志</span><br><span class="line">sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="./cdh6.0-install-process/start.png" alt=""></p>
<p>遇到问题：</p>
<ol>
<li>Unable to retrieve non-local non-loopback IP address. Seeing address: localhost/127.0.0.1. </li>
</ol>
<p><strong>找到问题了，before install 要先设置 network name,我之前没改<br>Set the hostname to a unique name (not localhost).</strong></p>
<ol start="11">
<li>进入web界面<br><img src="./cdh6.0-install-process/webmanager.png" alt=""><br>进入之后先同意协议，选择版本，选择免费或试用。<br>然后提示安装集群，先指定集群的机器。在输入框了里输入几个机器的 Hostname 然后点击搜索，下方会出现列表。<br><img src="./cdh6.0-install-process/searchHost.png" alt=""><br><strong>这里我已经选择过了 所以没勾选</strong></li>
</ol>
<p><strong>到一步我建议先去每台集群机器上面安装cloudera-manager-agent</strong><br>登到刚才安装了<code>cloudera-manager-server</code> 的机器，复制 <code>cloudera-manager-agent-6.0.0-530873.el7.x86_64.rpm</code> 和<code>cloudera-manager-daemons-6.0.0-530873.el7.x86_64.rpm</code>两个文件到其他机器<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp cloudera-manager-daemons-6.0.0-530873.el7.x86_64.rpm cdh@172.17.13.151:~</span><br></pre></td></tr></table></figure></p>
<p>然后在每台机器安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su cdh</span><br><span class="line">cd ~</span><br><span class="line">sudo yum install cloudera-manager-daemons-6.0.0-530873.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">sudo yum install cloudera-manager-agent-6.0.0-530873.el7.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p><img src="./cdh6.0-install-process/cdh-and-other-software.png" alt=""><br>下一步选择存储库，直接按推荐的就行，下面几个选项也不用选，因为上面包含了<br>这里 CDH 版本需要配置一下，否则只有 cdh5.14 而且是在线安装<br>首先<a href="https://archive.cloudera.com/cdh6/6.0.0/parcels/" target="_blank" rel="noopener">在这里</a>下载<br><code>CDH-6.0.0-1.cdh6.0.0.p0.537114-el6.parcel</code><br>移动到 <code>/opt/cloudera/parcel-repo</code> 目录下，然后做sha1校验</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 注意文件名</span><br><span class="line">sha1sum CDH-6.0.0-1.cdh6.0.0.p0.339140-el7.parcel | awk '&#123; print $1 &#125;' &gt; CDH-6.0.0-1.cdh6.0.0.p0.339140-el7.parcel.sha</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 修改文件的用户</span><br><span class="line">sudo chown -R cloudera-scm:cloudera-scm /opt/cloudera/parcel-repo/*</span><br><span class="line"></span><br><span class="line">sudo systemctl restart cloudera-scm-agent.service</span><br></pre></td></tr></table></figure>
<p>然后刷新一下页面再回到这一步，选择刚才下载的版本<br><img src="./cdh6.0-install-process/indtall-parcel.png" alt=""><br>等待安装。<br><strong>我这里遇到一个情况就是有一个机器没法激活</strong><br>解决办法是卸载 agent 重新安装了<br>如何卸载：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 检索安装列表</span><br><span class="line">sudo rpm -qa | grep cloudera</span><br><span class="line"><span class="meta">#</span> 卸载agent</span><br><span class="line">sudo rpm -e cloudera-manager-agent-6.0.0-530873.el7.x86_64 --nodeps</span><br><span class="line"><span class="meta">#</span> 删除配置文件</span><br><span class="line">sudo rm -rf /etc/cloudera-scm-agent/config.ini.rpmsave</span><br><span class="line"><span class="meta">#</span> 重新安装</span><br><span class="line">sudo yum install cloudera-manager-agent-6.0.0-530873.el7.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p><img src="./cdh6.0-install-process/install-parcel-finished.png" alt=""><br>ok<br>下一步检查机器配置是否正确<br><img src="./cdh6.0-install-process/inspect-host.png" alt=""></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sysctl vm.swappiness=10</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br><span class="line"><span class="meta">#</span> 添加到开机运行</span><br><span class="line">vim /etc/rc.local </span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</span><br><span class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</span><br></pre></td></tr></table></figure>
<p>改了以后点击完成就到集群设置页面了<br><img src="./cdh6.0-install-process/select-service.png" alt=""><br>这里有模版也可以全部安装也可以自定义，我就自定义装几个试试<br><img src="./cdh6.0-install-process/host-service.png" alt=""><br>大概这样，这次主要还是 hdfs 所以一共五台机器，可以发现 140 上的服务有点多，所以后面应当多几台机器，不要把dataNode部署到应用服务器上面，因为dataNode会占用IO<br><img src="./cdh6.0-install-process/database-set-up.png" alt=""><br>设置数据库，没啥说的，之前建表的怎么建这里怎么写<br>然后审核更改，可以改一些参数啥的，再下一步开始安装了</p>
<p><img src="./cdh6.0-install-process/command-detail.png" alt=""><br>都ok，点击继续，完成。</p>
</div><div class="article-meta" style="max-width:800px"><div class="tags"><i class="icon icon-tag"></i><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/hadoop/">hadoop</a><span class="tag-list-count">2</span></li></ul></div></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2018/12/26/Java/Spring boot-interceptor-configure/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2018/09/20/Java/java-nio/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/geyingauv" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/geyingauv" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2018 Virle's blog</p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>