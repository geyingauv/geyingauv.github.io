<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Mongodb 复制集部署 + 权限认证</title>
      <link href="/2018/08/22/Mongodb/MongodbReplset/"/>
      <url>/2018/08/22/Mongodb/MongodbReplset/</url>
      <content type="html"><![CDATA[<h1 id="Mongodb-复制集部署-权限认证"><a href="#Mongodb-复制集部署-权限认证" class="headerlink" title="Mongodb 复制集部署 + 权限认证"></a>Mongodb 复制集部署 + 权限认证</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><p>机器：</p><ul><li>host 1:27017 Primary</li><li>host 1:27018 Arbiter<ul><li>host 2:27017 Secondary</li></ul></li></ul><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>两台机器分别部署两个节点，Primary 提供服务，Secondary 提供备份，当 Primary 宕机时，Secondary 可以代替 Primary 继续提供服务</p><h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol><li><p>在 host 1 启动 Primary</p></li><li><p>在 host 2 启动 Secondary</p></li><li><p>在 host 1 启动 Arbiter</p></li><li><p>初始化 Replset</p></li><li><p>查看状态</p></li><li><p>测试</p></li></ol><hr><p><strong>本文中 {depPath} 指 mongodb 存放的路径 ，配置文件中为了方便查看，实际使用时请自行补全</strong></p><p>创建 keyfile ，使用 keyfile 校验才能加入复制集</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwd </span><br><span class="line"><span class="meta">#</span>  &#123;depPath&#125;/mongodb</span><br><span class="line">openssl rand -base64 756 &gt; keyfile</span><br><span class="line">chmod 600 keyfile  # 官方文档写的400</span><br></pre></td></tr></table></figure><p>复制keyfile到各实例目录下，注意用户和用户组，保证启动 mongodb 实例的用户有访问权限 keyfile 权限过大无法启动实例</p><p>host1：{depPath}/mongodb/mongodb.cnf</p><p>host2：{depPath}/mongodb/mongodb.cnf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span>=<span class="number">27017</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dbpath</span>=/mongodb/data/</span><br><span class="line"></span><br><span class="line"><span class="attr">logpath</span>=/mongodb/mongodb.log</span><br><span class="line"></span><br><span class="line"><span class="attr">pidfilepath</span>=/mongodb/mongo.pid</span><br><span class="line"></span><br><span class="line"><span class="attr">logappend</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">fork</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bind_ip</span>=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#auth=true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">storageEngine</span>=wiredTiger</span><br><span class="line"></span><br><span class="line"><span class="attr">wiredTigerCacheSizeGB</span>=<span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#keyFile=/mongodb/keyfile</span></span><br><span class="line"></span><br><span class="line"><span class="attr">replSet</span>=reptest</span><br></pre></td></tr></table></figure><p>host1：{depPath}/mongodb_arb/mongodb.cnf</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span>=<span class="number">27017</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dbpath</span>=/mongodb_arb/data/arb</span><br><span class="line"></span><br><span class="line"><span class="attr">logpath</span>=/mongodb_arb/mongodb.log</span><br><span class="line"></span><br><span class="line"><span class="attr">pidfilepath</span>=/mongodb_arb/mongo.pid</span><br><span class="line"></span><br><span class="line"><span class="attr">logappend</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">fork</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bind_ip</span>=<span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">auth</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">storageEngine</span>=wiredTiger</span><br><span class="line"></span><br><span class="line"><span class="attr">wiredTigerCacheSizeGB</span>=<span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="attr">keyFile</span>=/mongodb_arb/keyfile</span><br><span class="line"></span><br><span class="line"><span class="attr">replSet</span>=reptest</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> host 1: 启动 Primary , </span><br><span class="line">/mongodb/bin/mongodb -f /mongodb/mongodb.cnf</span><br><span class="line"><span class="meta">#</span> 进入 mongo shell</span><br><span class="line">/mongodb/bin/mongo</span><br><span class="line"><span class="meta">#</span> 首次进入创建用户</span><br><span class="line">use admin</span><br><span class="line"><span class="meta">#</span> 创建 admin 管理员</span><br><span class="line">db.createUser(</span><br><span class="line">  &#123;</span><br><span class="line">    user: "root",</span><br><span class="line">    pwd: "root",</span><br><span class="line">    roles: [ &#123; role: "userAdminAnyDatabase", db: "admin" &#125; ]</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"><span class="meta">#</span> 创建clusterAdmin</span><br><span class="line">db.createUser(</span><br><span class="line">&#123;</span><br><span class="line">user: "dba",</span><br><span class="line">pwd: "dba",</span><br><span class="line">roles: [ &#123; role: "clusterAdmin", db: "admin" &#125; ]</span><br><span class="line">&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>首次通过本地的 <code>shell</code>进入，是可以直接创建用户的，之后创建用户需要认证 <code>admin</code> 角色。</p><p>创建完用户把配置文件中的 <code>keyfile</code> 和 <code>auth</code> 注释取消掉，重启 host 1 Primary 实例</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> host 2: 启动 Secondary </span><br><span class="line">/mongodb/bin/mongodb -f /mongodb/mongodb.cnf</span><br><span class="line"><span class="meta">#</span> host 1: 启动 Arbiter</span><br><span class="line">/mongodb_arb/bin/mongodb /mongodb_arb/mongodb.cnf</span><br></pre></td></tr></table></figure><p>在 host 1 进入 mongo shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>## host 和 ip 请自行替换</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 进入 shell</span><br><span class="line">/mongodb/bin/mongo</span><br><span class="line">use admin </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 认证（clusterAdmin）</span><br><span class="line">db.auth('dba','dba')</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 初始化复制集</span><br><span class="line">rs.initiate(</span><br><span class="line">   &#123;</span><br><span class="line">      _id: "reptest",</span><br><span class="line">      version: 1,</span><br><span class="line">      members: [</span><br><span class="line">         &#123; _id: 0, host : "host 1:27017" &#125;,</span><br><span class="line">         &#123; _id: 1, host : "host 2:27017" &#125;,</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 添加一个 Arb 节点</span><br><span class="line">rs.addArb("host 1:27018")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 查看状态</span><br><span class="line">rs.status()</span><br></pre></td></tr></table></figure><p>rs 命令只能在 Primary 节点修改设置，是否为 Primary 显示在命令行头部</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reptest:PRIMARY&gt;</span><br><span class="line">reptest:SECONDARY&gt;</span><br></pre></td></tr></table></figure><h2 id="spring-data-mongodb-复制集配置"><a href="#spring-data-mongodb-复制集配置" class="headerlink" title="spring-data-mongodb 复制集配置"></a>spring-data-mongodb 复制集配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如果需要验证 使用 credentials 属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mongo:mongo-client</span> <span class="attr">id</span>=<span class="string">"mongo"</span> <span class="attr">replica-set</span>=<span class="string">"host 1:27017，host 2:27017"</span> <span class="attr">credentials</span>=<span class="string">"databaseName:username@password"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">mongo:client-options</span> <span class="attr">write-concern</span>=<span class="string">"SAFE"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connections-per-host</span>=<span class="string">"8"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">threads-allowed-to-block-for-connection-multiplier</span>=<span class="string">"4"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">connect-timeout</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">max-wait-time</span>=<span class="string">"1500"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">socket-keep-alive</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">socket-timeout</span>=<span class="string">"1500"</span></span></span><br><span class="line"><span class="tag">           /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mongo:mongo-client</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mongo:db-factory</span> <span class="attr">dbname</span>=<span class="string">"databaseName"</span> <span class="attr">mongo-ref</span>=<span class="string">"mongo"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"mongoTemplate"</span> <span class="attr">class</span>=<span class="string">"org.springframework.data.mongodb.core.MongoTemplate"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"mongoDbFactory"</span> <span class="attr">ref</span>=<span class="string">"mongoDbFactory"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://docs.mongodb.com/v3.6/tutorial/create-users/#add-users" target="_blank" rel="noopener">Add Users</a></p><p><a href="https://docs.mongodb.com/v3.6/tutorial/enable-authentication/#enable-auth" target="_blank" rel="noopener">Enable Auth</a></p><p><a href="https://docs.mongodb.com/v3.6/tutorial/deploy-replica-set-with-keyfile-access-control/index.html#deploy-new-replica-set-with-keyfile-access-control" target="_blank" rel="noopener">Deploy New Replica Set With Keyfile Access Control</a></p><p><a href="https://docs.mongodb.com/v3.6/tutorial/enforce-keyfile-access-control-in-existing-replica-set/#enforce-keyfile-access-control-in-a-replica-set" target="_blank" rel="noopener">Enforce Keyfile Access Control in a Replica Set</a></p><p><a href="https://docs.mongodb.com/v3.6/replication/#replication" target="_blank" rel="noopener">Replication</a></p><p><a href="https://docs.mongodb.com/v3.6/core/replica-set-arbiter/#replica-set-arbiter" target="_blank" rel="noopener">Replica Set Arbiter</a></p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>部署时遇到的问题挺多，比如认证是以前就有的，在配置文件中使用了 <code>ReplSet</code> 和 <code>keyfile</code> 后 mongo shell 中执行的命令很多都提示没有认证 <code>admin</code> 权限，后来发现使用 <code>ReplSet</code> 执行命令需要 <code>clusterAdmin</code>。</p><p>本来目的时两个节点可以互相切换。实际操作时一个节点挂掉，另一个并不会自动切换为 PRIMARY ，后来通过文档发现有 <a href="https://docs.mongodb.com/v3.6/core/replica-set-arbiter/#replica-set-arbiter" target="_blank" rel="noopener">Replica Set Arbiter</a> 的概念，因为只有一个节点时无法完成投票选举，需要添加一个 Arbiter 节点来投票。</p><p>多看文档少百度，文章是部署后所写，只提供思路和流程，具体操作请按实际环境进行相应的修改，如有错误之处，还望指出。</p>]]></content>
      
      
        <tags>
            
            <tag> Mongodb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Swift URLSession 网络请求</title>
      <link href="/2018/08/06/Swift/URLSession/"/>
      <url>/2018/08/06/Swift/URLSession/</url>
      <content type="html"><![CDATA[<h1 id="Swift网络请求"><a href="#Swift网络请求" class="headerlink" title="Swift网络请求"></a>Swift网络请求</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>macOS High Sierra 10.13.6 </li><li>X Code 9.4.1</li><li>Swift 4.1</li></ul><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><ol><li>创建URLSession</li><li>创建URLSessionTask</li><li>捕获Response</li><li>执行Task</li></ol><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: <span class="string">"https//www.baidu.com"</span>) <span class="comment">//创建url</span></span><br><span class="line"><span class="comment">// let url = URL(string: "http//www.baidu.com") </span></span><br><span class="line"><span class="comment">//创建dataTask 并捕获结果</span></span><br><span class="line"><span class="keyword">let</span> dataTask = <span class="type">URLSession</span>.shared.dataTask(with: url!) &#123; (data, response, error) <span class="keyword">in</span></span><br><span class="line"><span class="comment">// 错误退出</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</span><br><span class="line"><span class="built_in">print</span>(error)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 状态码判断</span></span><br><span class="line"><span class="keyword">guard</span> <span class="keyword">let</span> httpResponse = response <span class="keyword">as</span>? <span class="type">HTTPURLResponse</span>,(<span class="number">200</span> ... <span class="number">299</span>).<span class="built_in">contains</span>(httpResponse.statusCode) <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"wrong statusCode"</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 判断返回结果类型，输出内容</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">let</span> mimeType = httpResponse.mimeType, mimeType == <span class="string">"text/html"</span>,</span><br><span class="line"><span class="keyword">let</span> data = data,</span><br><span class="line"><span class="keyword">let</span> string = <span class="type">String</span>(data: data, encoding: .utf8)&#123;</span><br><span class="line"><span class="built_in">print</span>(string)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 执行</span></span><br><span class="line">dataTask.resume()</span><br></pre></td></tr></table></figure><h2 id="可能出现的问题"><a href="#可能出现的问题" class="headerlink" title="可能出现的问题"></a>可能出现的问题</h2><h3 id="http协议的请求无法访问-The-resource-could-not-be-loaded-because-the-App-Transport-Security-policy-requires-the-use-of-a-secure-connection"><a href="#http协议的请求无法访问-The-resource-could-not-be-loaded-because-the-App-Transport-Security-policy-requires-the-use-of-a-secure-connection" class="headerlink" title="http协议的请求无法访问 The resource could not be loaded because the App Transport Security policy requires the use of a secure connection."></a>http协议的请求无法访问 <strong>The resource could not be loaded because the App Transport Security policy requires the use of a secure connection.</strong></h3><p>编辑 <code>info.plist</code> 文件</p><p><code>Information Property List</code> 点击 + ， 添加 <code>App Transport Security Settings</code> ，点击 <code>+</code> 添加子属性 <code>Allow Arbitrary Loads</code> 设置值为 <code>YES</code></p><h3 id="无法连接到网络-找不到-dns-A-server-with-the-specified-hostname-could-not-be-found"><a href="#无法连接到网络-找不到-dns-A-server-with-the-specified-hostname-could-not-be-found" class="headerlink" title="无法连接到网络/找不到 dns A server with the specified hostname could not be found."></a>无法连接到网络/找不到 dns <strong>A server with the specified hostname could not be found.</strong></h3><p>错误日志：</p><blockquote><p>nw_resolver_create_dns_service_locked DNSServiceCreateDelegateConnection failed:</p><p>NSErrorFailingURLStringKey=<a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com/</a>, NSErrorFailingURLKey=<a href="http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com/</a>, _kCFStreamErrorDomainKey=10, _kCFStreamErrorCodeKey=-72000, NSLocalizedDescription=A server with the specified hostname could not be found.} </p></blockquote><p>点击项目左侧导航栏中的项目名称，右侧顶部标签选择 <code>Capabilities</code> 找到第一项 <code>NetWork</code> 勾选 <code>Incoming Connections (Server)</code>  和 <code>Outgoing Connections (Client)</code></p><p>或者干脆直接把App SandBox关了</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Swift 相关的信息网上比较少，尤其在百度环境下，基本上没找到任何有用的信息，全都是无用的复制粘贴帖子，而且 Swift版本已经更新至 4， 很多方法已经过时或被删除或类名修改。遇到问题最好还是去 Google，Stack Overflow 。</p><p>网上的教程可以作为参考，本文中的代码在以后的版本也许不适用，所以使用还得借助官方的文档，文档可以在官网或 X Code 中找到 （ Shift + Command + 0 / Help - Developer Documentation）</p>]]></content>
      
      
        <tags>
            
            <tag> Swift </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>R 语言连接数据库</title>
      <link href="/2018/04/12/R/HowToConenctToDatabaseInR/"/>
      <url>/2018/04/12/R/HowToConenctToDatabaseInR/</url>
      <content type="html"><![CDATA[<h1 id="R-连接数据库"><a href="#R-连接数据库" class="headerlink" title="R 连接数据库"></a>R 连接数据库</h1><p>最近研究R连接数据库的方法，网上找到的帖子都千篇一律，经过测试整合，整理如下：</p><h2 id="连接mysql"><a href="#连接mysql" class="headerlink" title="连接mysql"></a>连接mysql</h2><p>mysql的连接比较简单，导入RMySQL的包直接就可以连接</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">installl.packages(<span class="string">"RMySQL"</span>)</span><br><span class="line"><span class="keyword">library</span>(<span class="string">"RMySQL"</span>)</span><br><span class="line">conn = dbConnect(MySQL(),dbname=<span class="string">"r_test"</span>,password=<span class="string">"123456"</span>,host=<span class="string">"localhost"</span>,username=<span class="string">"root"</span>)</span><br></pre></td></tr></table></figure><h3 id="获取数据的方式"><a href="#获取数据的方式" class="headerlink" title="获取数据的方式"></a>获取数据的方式</h3><ul><li><p>dbGetQuery(conn,statement)</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mydate &lt;- dbGetQuery(conn,<span class="string">"select * from test_table"</span>)</span><br></pre></td></tr></table></figure></li><li><p>dbSendQuery(conn,statement)</p> <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res &lt;- dbSendQuery(conn,<span class="string">"select * from test_table"</span>)</span><br><span class="line">mydata &lt;- dbFetch(res,n=-<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p> n是获取几条记录，-1为剩余所有</p></li></ul><h2 id="连接oracle"><a href="#连接oracle" class="headerlink" title="连接oracle"></a>连接oracle</h2><h3 id="首先要配置odbc数据源"><a href="#首先要配置odbc数据源" class="headerlink" title="首先要配置odbc数据源"></a>首先要配置odbc数据源</h3><ol><li>打开Oracle配置集成工具中的ODBC<strong>数据源管理器</strong></li><li>添加新的配置，选择oraclexxxx</li><li>DataSourceName 填Oracle （此处的值是数据源的值，在创建连接时需要使用）</li><li>Description 随意填写</li><li>TNS Service Name: 其实就是 ip / 实例名   （例如 172.17.17.1/erma）</li><li>UserID 连接oracle的用户名</li><li>点击 TestConnection 测试连接是否可用</li><li>输入密码 点击ok</li><li>显示connetcion successful</li></ol><p>此时已经可以在R中连接了</p><p>在终端输入 R</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ODBC)</span><br><span class="line"><span class="comment">#此处第一个参数“Oracle” 对应上面创建时填写的数据源</span></span><br><span class="line">myconn &lt;- odbcConnect(<span class="string">"Oracle"</span>,uid=<span class="string">""</span>,pwd=<span class="string">""</span>,believeNRows = <span class="literal">FALSE</span>)</span><br><span class="line">sqlQuery(conn,<span class="string">"select * from emp"</span>)</span><br></pre></td></tr></table></figure><h1 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h1><ul><li><p>此处注意 如果不加believeNRows = FALSE 可能会查不到数据</p><blockquote><p><a href="https://stackoverflow.com/questions/7425100/rodbc-queries-returning-zero-rows" target="_blank" rel="noopener">stackoverflow:Issue: RODBC (falsely) returning zero rows</a></p><p>R连接oracle数据库Error in odbcFetchRows negative length vectors are not allowed</p></blockquote></li><li><p>连接oracle时要开启服务，并且保证端口可用（排除防火墙）实例名要正确 </p></li></ul><p>连接成功后可以进行一些操作，如获取表数据之类，由于我只使用了sql查询，所以对其他方法没有细致的研究，有需要可以参考文档</p><p><a href="https://www.rdocumentation.org/packages/RMySQL/versions/0.10.13#functions" target="_blank" rel="noopener">Functions in RMySQL</a></p><p><a href="https://www.rdocumentation.org/packages/RODBC/versions/1.3-15#functions" target="_blank" rel="noopener">Functions in RODBC</a></p><p>以上</p>]]></content>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>如何在 Java 项目中调用 R</title>
      <link href="/2018/04/12/Java/HowtoInvokingRMethodInJava/"/>
      <url>/2018/04/12/Java/HowtoInvokingRMethodInJava/</url>
      <content type="html"><![CDATA[<p>环境：macos 10.12.5</p><h2 id="安装R环境"><a href="#安装R环境" class="headerlink" title="安装R环境"></a>安装R环境</h2><p><a href="https://cran.r-project.org/bin/macosx/" target="_blank" rel="noopener">Download</a><br>同意协议并安装<br>打开终端  </p><h2 id="安装Rserver包"><a href="#安装Rserver包" class="headerlink" title="安装Rserver包"></a>安装Rserver包</h2><p><code>cd /Applications/R.app/Contents/MacOS</code> 进入R应用目录<br><code>R CMD</code> 启动R命令行模式<br>下载<code>install.packages(&quot;Rserve&quot;)</code>  </p><h2 id="启动Rserver服务"><a href="#启动Rserver服务" class="headerlink" title="启动Rserver服务"></a>启动Rserver服务</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">library("Rserve")</span><br><span class="line"></span><br><span class="line">Rserve()</span><br></pre></td></tr></table></figure><p>显示</p><blockquote><p>Rserv started in daemon mode.  </p></blockquote><p>即表示启动成功  </p><h2 id="创建java项目"><a href="#创建java项目" class="headerlink" title="创建java项目"></a>创建java项目</h2><ul><li><p>maven配置</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rjava.version</span>&gt;</span>0.9-7<span class="tag">&lt;/<span class="name">rjava.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- rjava --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.lucarosellini.rJava/JRIEngine --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.lucarosellini.rJava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>JRIEngine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;rjava.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.lucarosellini.rJava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>REngine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;rjava.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.lucarosellini.rJava<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>JRI<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;rjava.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.yannrichet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Rsession<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建测试类<br>TestR.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.rosuda.REngine.REXP;</span><br><span class="line"><span class="keyword">import</span> org.rosuda.REngine.REXPMismatchException;</span><br><span class="line"><span class="keyword">import</span> org.rosuda.REngine.Rserve.RConnection;</span><br><span class="line"><span class="keyword">import</span> org.rosuda.REngine.Rserve.RserveException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConnect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            RConnection c = <span class="keyword">new</span> RConnection();</span><br><span class="line">            REXP x = c.eval(<span class="string">"R.version.string"</span>);</span><br><span class="line">          System.out.println(x.asString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RserveException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (REXPMismatchException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行测试<br>显示 R version 3.4.1<br>执行语句 eval<br>session.asString(“statement”)</p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>R 语言服务器环境部署</title>
      <link href="/2018/04/12/R/REnvironmentSetup/"/>
      <url>/2018/04/12/R/REnvironmentSetup/</url>
      <content type="html"><![CDATA[<h1 id="R-语言服务器环境部署"><a href="#R-语言服务器环境部署" class="headerlink" title="R 语言服务器环境部署"></a>R 语言服务器环境部署</h1><p>配置环境变量</p><p>R_HOME = R语言的安装路径</p><p>path 在末尾追加“;”号  %R_HOME%/bin</p><h1 id="安装所需的包"><a href="#安装所需的包" class="headerlink" title="安装所需的包"></a>安装所需的包</h1><p>其中用来连接的包叫Rserve</p><p>命令行输入R进入</p><p>输入</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">'Rserve'</span>)          <span class="comment">#java同个Rserve服务连接到R</span></span><br><span class="line"></span><br><span class="line">install.packages(<span class="string">'RMySQL'</span>)       <span class="comment">#R语言连接mysql</span></span><br><span class="line"></span><br><span class="line">install.packages(<span class="string">'rjson'</span>)             <span class="comment">#将数据转换为json格式</span></span><br><span class="line"></span><br><span class="line">install.packages(<span class="string">"forecast"</span>)      <span class="comment">#R语言模型预测的包</span></span><br></pre></td></tr></table></figure><h1 id="启动远程访问服务"><a href="#启动远程访问服务" class="headerlink" title="启动远程访问服务"></a>启动远程访问服务</h1><p>进入R的library目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd library/Rserve/libs/x64</span><br><span class="line">R CMD Rserve --RS-enable-remote  #开启远程访问</span><br></pre></td></tr></table></figure><h1 id="Attention"><a href="#Attention" class="headerlink" title="Attention"></a>Attention</h1><ul><li>在R中加载类并使用Rserve()方法启动以及在Rserve目录使用R CMD Rserve 均为本地访问，远程访问需要加后面的参数</li></ul>]]></content>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>数据分析中对缺失数据的处理方式</title>
      <link href="/2018/04/12/R/Rdeilmethods/"/>
      <url>/2018/04/12/R/Rdeilmethods/</url>
      <content type="html"><![CDATA[<ul><li><p>当缺失数据较少时直接删除相应样本</p><p>删除缺失数据样本，其前提是缺失数据的比例较少，而且缺失数据是随机出现的，这样删除缺失数据后对分析结果影响不大。</p></li><li><p>对缺失数据进行插补</p><p> 用变量均值或中位数来代替缺失值，其优点在于不会减少样本信息，处理简单。但是缺点在于当缺失数据不是随机出现时会产成偏误。</p><p>多重插补法（Multiple imputation）：多重插补是通过变量间关系来预测缺失数据，利用蒙特卡罗方法生成多个完整数据集，再对这些数据集分别进行分析，最后对这些分析结果进行汇总处理。可以用mice包实现。</p></li><li><p>使用对缺失数据不敏感的分析方法，例如决策树</p></li></ul>]]></content>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>R 语言词汇笔记</title>
      <link href="/2017/08/08/R/RWordsNote/"/>
      <url>/2017/08/08/R/RWordsNote/</url>
      <content type="html"><![CDATA[<p>forecast(x,level=置信度,h=周期)<br>accuracy()<br>ME：平均误差<br>RMSE：均方根误差<br>MAE：平均绝对误差<br>MPE：平均百分比误差<br>MAPE：平均绝对误差百分比<br>MASE：绝对尺度误差<br>ACF1：在滞后1误差自相关。  </p><p>fore$level 置信度<br>fore$lower 预测下界<br>fore$upper 预测上界<br>fore$mean 预测值</p><p>#回归分析</p><p>回归分析研究的主要步骤：</p><ol><li>确定因变量Y 与 自变量X1, X2, …, Xn 之间的定量关系表达式，即回归方程。</li><li>对回归方程的置信度检查。</li><li>判断自变量Xn(n=1,2,…,m)对因变量的影响。</li><li>利用回归方程进行预测。</li></ol>]]></content>
      
      
        <tags>
            
            <tag> R </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
